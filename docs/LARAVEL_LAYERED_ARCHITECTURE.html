<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laravel Layered Architecture</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
            color: #333;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            margin-top: 35px;
            margin-bottom: 20px;
        }
        h3 {
            color: #2c3e50;
            margin-top: 25px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #3498db;
            color: white;
            font-weight: 600;
        }
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        pre {
            background: #f1f3f4;
            color: #000000;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            margin: 20px 0;
        }
        code {
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        .flowchart {
            background: #e8f4f8;
            padding: 20px;
            border-left: 5px solid #3498db;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
        }
        .checklist {
            list-style: none;
            padding: 0;
        }
        .checklist li {
            padding: 8px 0;
            position: relative;
            padding-left: 30px;
        }
        .checklist li::before {
            content: "✅";
            position: absolute;
            left: 0;
        }
        .xmark li::before {
            content: "❌";
        }
        .citation {
            font-size: 0.85em;
            color: #7f8c8d;
            vertical-align: super;
        }
        footer {
            margin-top: 50px;
            padding-top: 30px;
            border-top: 1px solid #eee;
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
        }
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            table {
                font-size: 14px;
            }
            th, td {
                padding: 10px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Laravel Layered Architecture</h1>

        <h2>1. 기본 레이어드 아키텍처 (Controller-Service-Repository-Model)</h2>
        
        <h3>전형적인 4계층 구조</h3>
        <div class="flowchart">
클라이언트 요청 → Controller → <strong>Service(비즈니스 로직)</strong> → Repository → Model(DB)<br>
        </div>

        <table>
            <thead>
                <tr>
                    <th>레이어</th>
                    <th>주요 역할</th>
                    <th>책임</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>Controller</strong></td>
                    <td>HTTP 요청/응답 처리</td>
                    <td>입력 검증, 파라미터 바인딩, 예외 처리, Service 위임</td>
                </tr>
                <tr>
                    <td><strong>Service</strong></td>
                    <td>비즈니스 로직 구현</td>
                    <td>트랜잭션 관리, 보안, 로깅, 다중 Repository 조율</td>
                </tr>
                <tr>
                    <td><strong>Repository</strong></td>
                    <td>데이터 저장소 추상화</td>
                    <td>CRUD 작업, 쿼리 실행, DB 매핑</td>
                </tr>
                <tr>
                    <td><strong>Model</strong></td>
                    <td>데이터 구조 정의</td>
                    <td>도메인 엔티티, 속성/관계 표현</td>
                </tr>
            </tbody>
        </table>

        <h2>2. Laravel에서의 특이점 (Active Record 패턴)</h2>

        <h3>Eloquent Model의 Repository 역할</h3>
        <p>Laravel Eloquent는 <strong>Active Record 패턴</strong>을 구현해 Model이 Repository 기능을 내장합니다.</p>

        <pre><code>// Repository 없이 바로 사용 가능
User::create($data);           // CREATE
$user = User::find(1);         // READ  
$user->update($data);          // UPDATE
$user->delete();               // DELETE</code></pre>

        <p><strong>결과</strong>: 대부분 프로젝트에서 <strong>Controller-Service-Model</strong> 3계층으로 충분</p>

        <h2>3. Laravel 권장 구조</h2>

        <div class="flowchart">
Controller (요청처리)<br>
    ↓<br>
Service (비즈니스 로직)<br>
    ↓<br>
Model/Eloquent (데이터 작업)
        </div>

        <table>
            <thead>
                <tr>
                    <th>프로젝트 규모</th>
                    <th>권장 구조</th>
                    <th>이유</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>소규모</strong></td>
                    <td>Controller-Service-Model</td>
                    <td>간결함, 빠른 개발</td>
                </tr>
                <tr>
                    <td><strong>중규모</strong></td>
                    <td>Controller-Service-Model</td>
                    <td>Eloquent 충분</td>
                </tr>
                <tr>
                    <td><strong>대규모</strong></td>
                    <td>Controller-Service-Repository-Model</td>
                    <td>테스트, 쿼리 최적화 필요</td>
                </tr>
            </tbody>
        </table>

        <h2>4. 실제 구현 예시</h2>

        <h3>Controller</h3>
        <pre><code>class UserController extends Controller {
    public function store(Request $request, UserService $service) {
        $user = $service->createUser($request->validated());
        return response()->json($user);
    }
}</code></pre>

        <h3>Service</h3>
        <pre><code>class UserService {
    public function createUser(array $data) {
        return User::create($data);  // Eloquent 직접 사용
    }
}</code></pre>

        <h3>Model (Repository 역할 내장)</h3>
        <pre><code>class User extends Model {
    protected $fillable = ['name', 'email'];
}</code></pre>

        <h2>5. Repository 도입 시기</h2>

        <h3>추가 필요 상황</h3>
        <ul class="checklist">
            <li>복잡한 쿼리 최적화 (N+1 문제)</li>
            <li>다중 데이터소스 (DB, API, Cache)</li>
            <li>단위테스트 Mocking</li>
            <li>DB 변경 대비 (MySQL → PostgreSQL)</li>
        </ul>

        <h3>불필요한 상황</h3>
        <ul class="checklist xmark">
            <li>단순 CRUD</li>
            <li>단일 DB 환경</li>
            <li>빠른 프로토타이핑</li>
        </ul>

        <h2>6. 최종 권장사항</h2>

        <p><strong>Laravel 프로젝트 90%는 Controller-Service-Model로 충분</strong>합니다.</p>

        <p>Repository는 "필요할 때" 도입하는 선택적 레이어로, 과도한 추상화는 개발 속도 저하를 초래합니다.</p>

        <footer>
            <p>*작성일: 2025.12.18 | Laravel 11.x 기준*</p>
        </footer>
    </div>
</body>
</html>

